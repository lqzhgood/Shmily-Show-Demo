"use strict";(self["webpackChunkShmily"]=self["webpackChunkShmily"]||[]).push([[9081],{93823:function(e,t,n){n.d(t,{Z:function(){return u}});var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",{staticClass:"actions"},[n("el-button",{attrs:{icon:"el-icon-folder-add",title:"创建并打开文件夹",type:"warning"},on:{click:function(t){return e.createFolder(e.commentSId)}}})],1)},i=[],r=n(53943),a={name:"Dev-Comment-Actions",props:{commentSId:String},methods:{createFolder(e){r.Z.get(`/comment/createFolder?id=${e}`).catch((e=>{console.warn("❌",e.message)}))}}},l=a,o=n(1001),c=(0,o.Z)(l,s,i,!1,null,"15a718f0",null),u=c.exports},58643:function(e,t,n){n.d(t,{Z:function(){return h}});var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("Snippets",{attrs:{snippets:e.snippets}},e._l(e.COMMENT_TAGS,(function(t){return n("el-tag",{key:t,staticClass:"tag",attrs:{effect:"plain",type:"success"},on:{click:function(n){return e.addTag("<tag>"+t+"</tag>")}}},[e._v(e._s(t))])})),1),n("Input",{ref:"input",attrs:{clearable:"",placeholder:"请输入html"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?(t.preventDefault(),void(e.subFn&&e.subFn())):null},keyup:function(t){return t.ctrlKey?(t.stopPropagation(),t.preventDefault(),e.ShortcutKeyElm(t)):null}},model:{value:e.textInner,callback:function(t){e.textInner=t},expression:"textInner"}})],1)},i=[],r=n(74549),a=n(56754),l=n(53943),o=n(89590),c=n(72217),u=n(95787),p=(e,t,n)=>[{label:"a-page-statistic",fn:async()=>{const[t,n]=await e.msgBoxPrompt({title:"请输入统计子页面"});if(t||!n.trim())return;const s=(0,u.gZ)(n);e.insertComment(s),(0,r.Message)({type:"success",message:"成功"})}},{label:"a-query",key:"q",fn:async()=>{const t=(0,u.qA)("__id__","__day__"),n=(0,c.replaceSpecialKeyInStrToRegExp)(t).replace("__id__",u.ty.toString().replace(/(^\/|\$\/$)/g,"")).replace("__day__","\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}"),s=new RegExp(n),i=await(0,c.getClipboardContents)();let a;if(s.test(i))a=i;else if(u.ty.test(i))a=l(i);else{const[t,n]=await e.msgBoxPrompt({title:"请输入 [id]",inputPattern:u.ty,inputErrorMessage:"id 格式不正确"});if(t)return;a=l(n)}function l(e){return(0,u.qA)(e)}e.insertComment(a),(0,r.Message)({type:"success",message:"成功"})}},{label:"a-search",key:"s",des:"搜索内容",fn:async()=>{let t;try{await r.MessageBox.confirm("","搜索类型选择",{confirmButtonText:u.HW,cancelButtonText:u.FP,distinguishCancelAndClose:!0}),t=u.HW}catch(a){if("cancel"!==a)return;t=u.FP}const[n,s]=await e.msgBoxPrompt({title:"请输入搜索内容"});if(n)return;const i=(0,u.N0)(t,s);e.insertComment(i),(0,r.Message)({type:"success",message:"成功"})}},{label:"a-file",key:"f",fn:async()=>{const n=await e.getFiles(),s=n.filter((e=>![...u.fQ,...u.fd,...u.Q5].includes("."+e.split(".").pop().toLowerCase())));let i;if(1===s.length)i=s[0];else{const[t,s]=await e.msgBoxPrompt({message:e.msgBoxListVNode(n),title:"请输入 [文件] 名",inputValidator:e=>!u.ty.test(e),inputErrorMessage:"你输入的是 [id]， 此处应该是文件名"});if(t)return;i=s}const r=(0,u.bB)(t,i);e.insertComment(r,r,"end"),(0,c.openWin)((0,u.kH)(t,i))}},{label:"img",fn:async()=>{const n=await e.getFiles(),s=n.filter((e=>u.fQ.includes("."+e.split(".").pop().toLowerCase())));let i;if(1===s.length)i=s[0];else{const[t,s]=await e.msgBoxPrompt({message:e.msgBoxListVNode(n),title:"请输入 [图片] 文件名"});if(t)return;i=s}const r=(0,u.YU)(t,i);e.insertComment(r,r,"end")}},{label:"video",fn:async()=>{const n=await e.getFiles(),s=n.filter((e=>u.fd.includes("."+e.split(".").pop().toLowerCase())));let i;if(1===s.length)i=s[0];else{const[t,s]=await e.msgBoxPrompt({message:e.msgBoxListVNode(n),title:"请输入 [视频] 文件名"});if(t)return;i=s}const r=(0,u.JW)(t,i);e.insertComment(r,r,"end")}},{label:"audio",fn:async()=>{const n=await e.getFiles(),s=n.filter((e=>u.Q5.includes("."+e.split(".").pop().toLowerCase())));let i;if(1===s.length)i=s[0];else{const[t,s]=await e.msgBoxPrompt({message:e.msgBoxListVNode(n),title:"请输入 [音频] 文件名"});if(t)return;i=s}const r=(0,u.GO)(t,i);e.insertComment(r,r,"end")}},{label:"hr",str:"<hr/>"},{label:"p"},{label:"b"},{label:"i"},{label:"div-ref",str:`<div class="reference">${n}</div>`},{label:"div-center",str:`<div class="align-center">${n}</div>`},{label:"c-center",str:"align-center",type:"success"},{label:"TODO",str:"<p>TODO</p>",type:"danger"}],m={mixins:[o.Z],props:{commentSId:String,subFn:Function},data:()=>({COMMENT_TAGS:a.COMMENT_TAGS}),computed:{textDefault(){return`<p>${this.replaceKey}</p>`},snippets(){const e=this,t=this.commentSId,n=this.replaceKey;return p(e,t,n)}},methods:{addTag(e){this.textInner.includes(e)?this.textInner=this.textInner.replace(e,""):this.insertSnippet(e,0)},async ShortcutKeyElm(e){const{key:t}=e,n=t.toLowerCase(),s=this.snippets.find((e=>e.key===n));s?await s.fn():["i","b","p"].includes(n)&&this.insertSnippet(this.simpleElm(n))},async getFiles(){const e=this.commentSId;let t=[];try{const{result:n}=await l.Z.get(`/comment/getFolderFiles?id=${e}`);t=n,0===t.length&&await l.Z.get(`/comment/createFolder?id=${e}`)}catch(n){console.log("axios /comment/getFolderFiles error",n.message)}return t},insertComment(e,t,n){this.textInner===this.textDefault||""===this.textInner.trim()?this.textInner=t||`<p>${e}</p>`:this.insertSnippet(e,n)},msgBoxListVNode(e){const t=this.$createElement;return t("div",[e.map((e=>t("el-link",{attrs:{icon:"el-icon-document-copy"},style:"font-size:12px;display:block",nativeOn:{click:()=>(0,c.copyText)(e,r.Message.success,r.Message.error)}},[e.replace(/(?<=.{8})(.+)(?=.{8})/," ...... ")])))])}}},d=m,f=n(1001),g=(0,f.Z)(d,s,i,!1,null,"b1e33c74",null),h=g.exports},89590:function(e,t,n){n.d(t,{Z:function(){return v}});var s=n(74549),i=n(95787),r=n(86275),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"snippets"},[n("div",e._l(e.snippets,(function(t){return n("el-tag",{key:t.label,staticClass:"tag",attrs:{title:e.titleValue(t),type:t.type||"warning"},on:{click:function(n){return e.clickTag(t)}}},[e._v(e._s(t.label))])})),1),n("hr"),n("div",[e._t("default")],2)])},l=[],o={name:"HTML_INPUT_SNIPPETS",props:{snippets:{require:!0,type:Array,default(){return[]}}},data:()=>({}),methods:{clickTag(e){e.fn?e.fn():this.insertSnippet(e.str||this.simpleElm(e.label))},insertSnippet(...e){this.$parent.insertSnippet(...e)},simpleElm(...e){return this.$parent.simpleElm(...e)},titleValue(e){if(!e.key&&!e.des)return"";const t=e.key?`Ctrl+${e.key}`:"",n=e.des;return t&&n?`${t}\n${n}`:t||n}}},c=o,u=n(1001),p=(0,u.Z)(c,a,l,!1,null,"4cf43ebd",null),m=p.exports,d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-input",e._g(e._b({ref:"input",attrs:{rows:e.rows,type:"textarea"},on:{focus:function(t){return e.moveCursor()}},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"tab",9,t.key,"Tab")||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:(t.preventDefault(),e.moveCursor())}},model:{value:e.text,callback:function(t){e.text=t},expression:"text"}},"el-input",e.$attrs,!1),e.$listeners))},f=[],g={name:"Dev-Common-HtmlInput-Input",model:{prop:"value",event:"input"},props:{rows:{type:Number,require:!0,default:5},value:String},data:()=>({}),computed:{text:{get(){return this.value},set(e){this.$emit("input",e)}}},methods:{moveCursor(...e){this.$parent.moveCursor(...e)},getInput(){return this.$refs.input.getInput()},focus(){this.$refs.input.focus()}}},h=g,y=(0,u.Z)(h,d,f,!1,null,"6684fe87",null),x=y.exports,v={props:{msg:Object,show:Boolean,text:{require:!0,type:String},canDel:{require:!0,type:Boolean}},data:()=>({replaceKey:i.AP}),computed:{textDefault(){return""},textInner:{get(){return this.text},set(e){this.$emit("update:text",e)}},inputElm(){return this.$refs.input.getInput()}},watch:{show:{immediate:!0,handler(e){e&&this.focus()}}},methods:{async msgBoxPrompt(e={}){const{message:t="",title:n=""}=e,i=`msg-box-prompt-${Date.now()}`,r=s.MessageBox.prompt(t,n,{inputValue:"",confirmButtonText:"确定",cancelButtonText:"取消",customClass:i,...e}).then((({action:e,value:t})=>[null,t.trim()])).catch((e=>((0,s.Message)({type:"info",message:"取消输入"+e.message}),[e])));await this.$nextTick();const a=document.querySelector("."+i);return a.onclick=function(e){e.stopPropagation()},r},insertSnippet(e,t){this.focus(),this.textInner=(0,r.O)(this.inputElm,e,this.textInner,t)},focus(){this.$nextTick((()=>{const e=this.inputElm===document.activeElement;e?this.moveCursor():this.$refs.input.focus()}))},moveCursor(){const e=this.inputElm;this.textInner.trim()||(this.textInner=this.textDefault),this.$nextTick((()=>{const t=e.selectionStart,n=this.textInner,s=n.substr(t),i=s.match(/^<\/[a-zA-Z]{1,7}>/);if(i){const n=t+i[0].length,s=n;return void e.setSelectionRange(n,s)}const r=s.indexOf(this.replaceKey);if(-1!==r){const t=n.length-s.length+r,i=t+this.replaceKey.length;return void e.setSelectionRange(t,i)}const a=n.indexOf(this.replaceKey);if(-1===a);else{const t=a+this.replaceKey.length;e.setSelectionRange(a,t)}}))},simpleElm(e){return`<${e}>${this.replaceKey}</${e}>`}},components:{Snippets:m,Input:x}}},86275:function(e,t,n){n.d(t,{O:function(){return a},u:function(){return r}});var s=n(92196),i=n.n(s);function r(e){const t=i().isString(e),n=t?JSON.parse(e):i().cloneDeep(e);n.direction="go"===n.direction?"come":"go";const{sender:s,senderName:r,receiver:a,receiverName:l}=n;return n.sender=a,n.senderName=l,n.receiver=s,n.receiverName=r,t?JSON.stringify(n,null,4):n}function a(e,t,n,s){let i;if(isNaN(s))switch(s){case"end":i=n.length;break;case"start":i=0;break}else i=Number(s);i=i??e.selectionStart;const r=n||e.value;return r.substr(0,i)+t+r.substr(i)}}}]);